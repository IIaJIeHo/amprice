<script>!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.store=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(a){"use strict";b.exports=function(){function b(){try{return g in e&&e[g]}catch(a){return!1}}var c,d={},e="undefined"!=typeof window?window:a,f=e.document,g="localStorage",h="script";if(d.disabled=!1,d.version="1.3.20",d.set=function(a,b){},d.get=function(a,b){},d.has=function(a){return void 0!==d.get(a)},d.remove=function(a){},d.clear=function(){},d.transact=function(a,b,c){null==c&&(c=b,b=null),null==b&&(b={});var e=d.get(a,b);c(e),d.set(a,e)},d.getAll=function(){},d.forEach=function(){},d.serialize=function(a){return JSON.stringify(a)},d.deserialize=function(a){if("string"==typeof a)try{return JSON.parse(a)}catch(b){return a||void 0}},b())c=e[g],d.set=function(a,b){return void 0===b?d.remove(a):(c.setItem(a,d.serialize(b)),b)},d.get=function(a,b){var e=d.deserialize(c.getItem(a));return void 0===e?b:e},d.remove=function(a){c.removeItem(a)},d.clear=function(){c.clear()},d.getAll=function(){var a={};return d.forEach(function(b,c){a[b]=c}),a},d.forEach=function(a){for(var b=0;b<c.length;b++){var e=c.key(b);a(e,d.get(e))}};else if(f&&f.documentElement.addBehavior){var i,j;try{j=new ActiveXObject("htmlfile"),j.open(),j.write("<"+h+">document.w=window</"+h+'><iframe src="/favicon.ico"></iframe>'),j.close(),i=j.w.frames[0].document,c=i.createElement("div")}catch(a){c=f.createElement("div"),i=f.body}var k=function(a){return function(){var b=Array.prototype.slice.call(arguments,0);b.unshift(c),i.appendChild(c),c.addBehavior("#default#userData"),c.load(g);var e=a.apply(d,b);return i.removeChild(c),e}},l=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g"),m=function(a){return a.replace(/^d/,"___$&").replace(l,"___")};d.set=k(function(a,b,c){return b=m(b),void 0===c?d.remove(b):(a.setAttribute(b,d.serialize(c)),a.save(g),c)}),d.get=k(function(a,b,c){b=m(b);var e=d.deserialize(a.getAttribute(b));return void 0===e?c:e}),d.remove=k(function(a,b){b=m(b),a.removeAttribute(b),a.save(g)}),d.clear=k(function(a){var b=a.XMLDocument.documentElement.attributes;a.load(g);for(var c=b.length-1;c>=0;c--)a.removeAttribute(b[c].name);a.save(g)}),d.getAll=function(a){var b={};return d.forEach(function(a,c){b[a]=c}),b},d.forEach=k(function(a,b){for(var c,e=a.XMLDocument.documentElement.attributes,f=0;c=e[f];++f)b(c.name,d.deserialize(a.getAttribute(c.name)))})}try{var n="__storejs__";d.set(n,n),d.get(n)!=n&&(d.disabled=!0),d.remove(n)}catch(a){d.disabled=!0}return d.enabled=!d.disabled,d}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});var unicode={escape:function(a){return a.replace(/^[-~]|\\/g,function(a){var b=a.charCodeAt(0);return"\\u"+(b<16?"000":b<256?"00":b<4096?"0":"")+b.toString(16)})},unescape:function(a){return a.replace(/\\u([a-fA-F0-9]{4})/g,function(a,b){return String.fromCharCode(parseInt(b,16))})}},app=angular.module("plunker",["nvd3","ngTable"]);app.controller("MainCtrl",["$scope","$http","NgTableParams",function(a,b,c){function e(){if(H(),D(),f(),window.localStorage){var b=store.get("tabledata");a.version=store.get("version")}b?(a.get_from_localStorage=!0,h(b),l(b.length,o)):o(),t(15)}function f(){b.get("http://amberprice.net/wp-json/posts?type[]=tableme&filter[category_name]=version").then(function(b){try{if(a.get_from_localStorage){var c=b.data[0].content.slice(3,-5).replace(/&#171;/g,'"').replace(/&#187;/g,'"').replace(/&#8212;/g,"-").replace(/&#8243;/g,'"');c=unicode.unescape(c),c=JSON.parse(c),c=c[0][0],a.version!=c&&window.localStorage&&(store.set("version",c),o())}}catch(a){}})}function g(a,b){if(a){var c=a.map(function(a){return a.title});return b.forEach(function(b){if(c.indexOf(b.title)!=-1){a.splice(c.indexOf(b.title),1,b)}else a.push(b)}),a}return b}function h(b){a.bundle=b,a.main=a.bundle.filter(function(b){return b.amber_type==a.state.amber_type&&b.amber_class==a.state.amber_class}).sort(function(a,b){return a.time-b.time}),a.store_indexes=a.bundle.filter(function(a){return"Indexes"==a.amber_type}).sort(function(a,b){return a.time-b.time});var d=B(angular.copy(a.store_indexes));if(d.length>0&&(d[d.length-1].data=d[d.length-1].data.map(function(a){return Object.assign({},a,{value:a.value,diff:z(a.diff),diff_absolute:z(a.diff_absolute)})}),a.amberindex=d[d.length-1].data.filter(function(a){return"Amber Index (AI)"==a.sub_type})[0],a.indexes=new c({count:100},{dataset:d[d.length-1].data}),a.select_indexes=d[d.length-1].data,a.select_indexes.length>0)){var e={},f=[];a.select_indexes.forEach(function(a){e[a.index_type]=1}),e=Object.keys(e),e.forEach(function(b){f[b]=[],a.select_indexes.forEach(function(a){a.index_type==b&&f[b].push(a.sub_type)})}),a.index_types=e,a.sub_types=f}a.pricelist=a.bundle.filter(function(a){return"pricelist"==a.type});var g=a.bundle.filter(function(a){return"descriptionindex"==a.type});g&&g[0]&&(a.descriptionindex=g[0].data),M(a.bundle.filter(function(a){return"deals"==a.type})),G(),a.currency=a.bundle.filter(function(a){return"currency"==a.type}),a.multilines&&(a.options.chart.width=800,a.options.chart.height=500,a.options.chart.legendPosition="bottom",a.options.chart.legend={padding:320,width:400,expanded:!0,maxKeyLength:100,margin:{top:15}}),a.currency.length>0&&(a.currency=a.currency[0].data.filter(function(a){return!!a.date}).map(function(a){return Object.assign({},a,{date:+new Date(a.date.split(".").join("/"))})}).sort(function(a,b){return a.date-b.date})),w(),L(),J(),a.link_to_pricelist=v();var h=a.display();h&&h.values&&h.values[0]&&0!=h.values[0].y&&(a.data=[a.display()]),a.api&&a.api.refresh(),a.showapp=!0}function j(a){return Math.round(100*parseFloat(a))/100}function k(a){return a.data.map(function(a){var b=a.content.slice(3,-5).replace(/&#171;/g,'"').replace(/&#187;/g,'"').replace(/&#8212;/g,"-").replace(/&#8243;/g,'"');if(b=unicode.unescape(b),b=JSON.parse(b),meta_data=a.title.split("/"),"amber"==meta_data[0])return"raw"==meta_data[2]?b="indonezian"==meta_data[3]?b.map(function(a){T(100,1e3);return{frakcii:n(a[0]),sort:d[a[1]],country:a[2],value:j(a[3])}}):"domenic"==meta_data[3]?b.map(function(a){T(100,1e3);return{frakcii:n(a[0]),sort:d[a[2]],form:d[a[1]],country:a[3],value:j(a[4])}}):b.map(function(a){T(100,1e3);return{frakcii:n(a[0]),form:d[a[2]],sort:d[a[1]],country:a[3],value:j(a[4])}}):"ball"==meta_data[2]?b="domenic"==meta_data[3]?b.map(function(a){T(100,1e3);return{frakcii:a[0],form:a[1],sort:d[a[2]],country:a[3],value:j(a[4])}}):b.map(function(a){T(100,1e3);return{frakcii:n(a[0]),form:d[a[1]],country:a[2],value:j(a[3])}}):"index"==meta_data[2]&&(b=b.map(function(a){var e;T(100,1e3),T(-100,100);return e="-"==a[0]?"General":d[a[0]],{index_type:e,sub_type:a[1],country:a[2],value:j(a[3])}})),{title:a.title,type:meta_data[0],time:+new Date(meta_data[1].split(".").join("/")),data:b,amber_type:d[meta_data[2]],amber_class:d[meta_data[3]]};if("currency"==meta_data[0])return labels=b[0],b=b.slice(1).map(function(a){for(var b=new Object,c=0;c<a.length;c++)b[labels[c]]=a[c];return b}),{title:a.title,type:meta_data[0],data:b};if("deals"==meta_data[0])return b=b.map(function(b){return{datetime:+new Date(b[0].split(".").join("/")+" "+b[1]),description:b[2],weight:b[3],old_value:b[4],value:b[5],diff:b[6],title:a.title}}),{type:meta_data[0],data:b};if("pricelist"==meta_data[0])return b=b.map(function(a){var b=a[0].slice(3,5)+"/"+a[0].slice(0,2)+"/"+a[0].slice(6);return{datetime:+new Date(Date.parse(b)),link:a[1]}}),{type:meta_data[0],data:b,title:a.title};if("descriptionindex"==meta_data[0]){var c={};return b.forEach(function(a){c[a[0]]=a[1]}),{type:meta_data[0],data:c,title:a.title}}return{}})}function l(a,c){b.get("http://amberprice.net/wp-json/posts?filter[posts_per_page]=1&type[]=tableme&page="+(a+1)).then(function(a){a.data.length>0&&c()})}function n(a){return a.replace(/г/g,"g").replace(/мм/g,"mm")}function o(){s(15);for(var a=5,b=1,c=b;c<8;c++)u(a,c)}function s(c){b.get("http://amberprice.net/wp-json/posts?filter[posts_per_page]="+c+"&type[]=tableme&filter[category_name]=first").then(function(b){if(0!=b.data.length){var c=k(b);q<7&&(a.bundle=g(a.bundle,c),h(a.bundle))}})}function t(c){b.get("http://amberprice.net/wp-json/posts?filter[posts_per_page]="+c+"&type[]=tableme&filter[category_name]=every").then(function(b){if(0!=b.data.length){var c=k(b);q<7&&(a.bundle=g(a.bundle,c),h(a.bundle))}})}function u(c,d){b.get("http://amberprice.net/wp-json/posts?filter[posts_per_page]="+c+"&type[]=tableme&page="+d).then(function(b){if(0!=b.data.length){var e=k(b);p=p.concat(e),a.bundle=g(a.bundle,e),r++,r%5==0&&h(a.bundle),u(c,d+7)}else q++,7==q&&(h(p),window.localStorage&&(store.remove("tabledata"),store.set("tabledata",p)))})}function v(){if(a.state.date){var b=a.state.date.value;if(a.pricelist[0]){var c=a.pricelist[0].data.filter(function(a){return a.datetime==b})[0];return c||(c=a.pricelist[0].data),c.link}return null}return null}function w(){a.data_bundle={},a.bundle.forEach(function(b){b.time&&b.amber_class&&b.amber_type&&(a.data_bundle[b.time]||(a.data_bundle[b.time]={}),a.data_bundle[b.time][b.amber_class]||(a.data_bundle[b.time][b.amber_class]={}),a.data_bundle[b.time][b.amber_class][b.amber_type]=b.data)}),a.data_bundle&&(a.select_options.date=Object.keys(a.data_bundle),a.select_options.date=a.select_options.date.map(function(b){return{name:a.format_date(b),value:b}}).sort(function(a,b){return a.value-b.value}),a.state.date=a.select_options.date[a.select_options.date.length-1])}function x(b,c,d){var e=Object.keys(a.data_bundle).sort(function(a,b){return parseInt(a)-parseInt(b)});if(a.data_bundle)for(var g,f=e.indexOf(b),h=f;h>=0;h--)if(a.data_bundle[e[h]]&&a.data_bundle[e[h]][c]&&(g=a.data_bundle[e[h]][c][d]),g)return g;return null}function z(a){return"number"==typeof a?a>0?"+"+a.toFixed(2):a.toFixed(2):"-"==a[0]?a:"+"+a}function A(){return[].slice.call(arguments,0).reduce(function(a,b){return a+b})}function B(b){return b=b.filter(function(b){return a.state.amber_class==b.amber_class}),b.map(function(c,d){return c.data=c.data.filter(function(b){return b.country==a.state.country}).map(function(a,c){if(b[d-1])try{a.diff_absolute=Math.round(100*(a.value-b[d-1].data[c].value))/100}catch(b){a.diff_absolute=0}else a.diff_absolute=0;return a.positive=a.diff_absolute>0,a.diff=Math.round(a.diff_absolute/(a.value-a.diff_absolute)*100*100)/100,a}),c})}function D(b){"Rough"==b?(a.state.frakcii="20-50g.",a.state.sort="ААА",a.state.form="Opaque/Beadable",a.state.country="Европа"):"Beads"==b?(a.state.frakcii="12mm+/1g+","Dominican"!=a.state.amber_class&&(a.state.form="Opaque/ААА"),a.state.country="Европа"):"Indexes"==b&&(a.state.index_type="General")}function F(b,c){var e,d=(new Date).getTime();if(e="3 months"==b?d-7776e6:"6 months"==b?d-15552e6:"1 year"==b?d-31104e6:0,"Absolute values"==c){var f=angular.copy(a.multidata_base);f=f.map(function(b){var c=b.values;return c=c.filter(function(a){return e<a.x}),c=c.map(function(b){return b.y=b.y*a.currency[a.currency.length-1][a.state.currency],b}),b.values=c,b}),Q(f),a.multidata=f,P(),a.api&&a.api.refresh()}else if("Percent Change"==c){var f=angular.copy(a.multidata_base);f=f.map(function(a){var b=a.values;b=b.filter(function(a){return e<a.x}),b=b.sort(function(a,b){return a.x-b.x});var c=b[0].y,d=angular.copy(b);return b.map(function(a,b,e){return 0==b?a.y=(a.y-c)/c*100:a.y=(d[b].y-d[b-1].y)/d[b-1].y*100,a}),a.values=b,a}),Q(f),P(f),a.multidata=f,a.api&&a.api.refresh()}a.multilines&&(E+=25,setTimeout(function(){jQuery("svg.nvd3-svg").height(E)},200))}function G(){a.curr={},a.select_options.amber_type.forEach(function(b){var c=a.bundle.filter(function(a){return b==a.amber_type}).sort(function(a,b){return a.time-b.time});a.select_options.amber_class.forEach(function(d){var e=c.filter(function(a){return d==a.amber_class}).sort(function(a,b){return a.time-b.time});a.curr[b+d]=e[e.length-1]})})}function H(){a.basestate={type:"amber",country:"Европа",form:"Opaque/Beadable",frakcii:"20-50g.",sort:"АА",currency:store.get("currency")||"EUR",amber_class:"Baltic",amber_type:"Rough",index_type:"General",date:null,sub_type:"Amber Index (AI)"},a.state={type:"amber",country:"Европа",form:"Opaque/Beadable",frakcii:"20-50g.",sort:"ААА",currency:store.get("currency")||"EUR",amber_class:"Baltic",amber_type:"Rough",index_type:"General",date:null,sub_type:"Amber Index (AI)"},a.select_options={country:["Россия","Европа","Гонконг"],currency:["EUR","RUB","USD","CNY","HKD","JPY","TRY","INR","MXN"],amber_class:["Baltic","Indonesian (Sumatra)","Ukrainian","Mexican (Chiapas)","Dominican"],amber_type:["Rough","Beads","Indexes"],index_type:["Rough","Beads","Indexes"],sort:["ААА","А","В","MIX","С"],form:["Opaque/Beadable","Transparent/Beadable","Opaque/Flat","Transparent/Flat"],frakcii:["1000g.","500g.","300g.","200g.","100g.","50-100g.","20-50g.","10-20g.","5-10g.","2.5-5g."],table:["Rough (medium fractions)","Rough (large fractions)","Opaque beads","Transparent beads","Indexes"],graph_time:["3 months","6 months","1 year","All data"],graph_type:["Absolute values","Percent Change"]},a.graph={graph_time:a.select_options.graph_time[0],graph_type:a.select_options.graph_type[0]},a.select_options.special={amber_class:["Baltic","Indonesian (Sumatra)","Ukrainian","Dominican"],frakcii:["50-100g.","20-50g.","10-20g.","5-10g.","2.5-5g."],frakcii2:[">1000g.",">500g.",">300g.",">200g.",">100g.","50-100g.","20-50g.","10-20g.","5-10g.","2.5-5g."]},a.select_options.indonezian={frakcii:[">300g.","50-300g.","<50g."],sort:["ААА","АА","А","В","С"],table:["Rough","Beads","Indexes"],form:["ААА","АА","А","В","С"]},a.select_options.domenic={frakcii:{raw:{big:[">100g.","75-100g.","50-75g.","40-50g.","30-40g.","20-30g.","10-20g.","<10g."],small:[">100g.","50-100g.","<50g."]},ball:["20+/5+","15+/2+","12+/1+","10+/0.5+","8+/0.25+","6+/0.1+","6-/0.1-"]},form:["ААА","АА","А"],sort:["Blue","Green","Yellow"],table:["Rough (blue)","Rough (green)","Rough (yellow)","Beads (blue)","Beads (green)","Beads (yellow)","Indexes"]},a.indostate={},a.indostate.form="ААА",a.indostate.frakcii=">1000g.",a.select_options.mexican={table:["Beads","Indexes"],amber_type:["Beads","Indexes"],form:["Opaque/ААА","Opaque/АА","Opaque/А","Opaque/В","Opaque/С"]},a.table_state="Rough (medium fractions)",a.select_options.ball={frakcii:["40mm+/30g+","35mm+/25g+","30mm+/20g+","25mm+/10g+","20mm+/5g+","15mm+/2g+","12mm+/1g+","10mm+/0.5g+","8mm+/0.25g+","6mm+/0.1g+","6mm-/0.1g-"],form:["Opaque/ААА","Opaque/АА","Opaque/А","Opaque/В","Opaque/С","Transparent/ААА","Transparent/АА","Transparent/А","Transparent/В","Transparent/С"]},a.format_date=function(a){var b=new Date(parseInt(a)),c=b.getDate(),d=b.getMonth()+1,e=b.getFullYear();return c<10&&(c="0"+c),d<10&&(d="0"+d),c+"."+d+"."+e},a.tables={},a.display=function(){var c,b=S();if(b[0]){0==a.currency.length&&(a.currency=[{EUR:1}]),a.state.currency||(a.state.currency="EUR"),c=b.map(function(b){return{x:+new Date(b.x.split(".").join("/")),y:+b.y*a.currency[a.currency.length-1][a.state.currency]}}),c=c.sort(function(a,b){return a.x-b.x});var e=c[0].x-864e5,f=864e5+c[c.length-1].x;a.multidata.length>0?(a.options.chart.xDomain[0]=e>a.options.chart.xDomain[0]?a.options.chart.xDomain[0]:e,a.options.chart.xDomain[1]=f>a.options.chart.xDomain[1]?f:a.options.chart.xDomain[1]):a.options.chart.xDomain=[e,f],y_values=c.sort(function(a,b){return a.y-b.y});var g=.96*c[0].y,h=1.04*c[c.length-1].y;return a.multidata.length>0?(a.options.chart.yDomain[0]=g>a.options.chart.yDomain[0]?a.options.chart.yDomain[0]:g,a.options.chart.yDomain[1]=h>a.options.chart.yDomain[1]?h:a.options.chart.yDomain[1]):a.options.chart.yDomain=[g,h],c.sort(function(a,b){return a.x-b.x}),{values:c,key:"Value("+a.state.currency+")",color:"#74aa9d",strokeWidth:2,classed:"dashed"}}return{values:{x:0,y:0},key:"Value("+a.state.currency+")",color:"#74aa9d",strokeWidth:2,classed:"dashed"}},a.criteria=R(),a.multidata=[],a.multidata_base=[],a.options={chart:{type:"lineChart",width:600,height:300,margin:{top:20,right:20,bottom:40,left:75},noData:"Add charts for comparision",x:function(a){return a?a.x:void(jQuery('[ng-bind="item.form0.toFixed(2)"]')[0]&&jQuery('[ng-bind="item.form0.toFixed(2)"]')[0].click())},y:function(b){return b?b.y:(a.change_state(a.basestate),void console.log("wowowowo"))},useInteractiveGuideline:!0,dispatch:{stateChange:function(a){console.log("stateChange")},changeState:function(a){console.log("changeState")},tooltipShow:function(a){console.log("tooltipShow")},tooltipHide:function(a){console.log("tooltipHide")}},xAxis:{axisLabel:"",tickFormat:function(a){return d3.time.format("%d.%m.%y")(new Date(a))}},yAxis:{axisLabel:"",tickFormat:function(a){return d3.format(".02f")(a)},axisLabelDistance:-10},callback:function(a){console.log("!!! lineChart callback !!!")},refreshDataOnly:!0},title:{enable:!0,text:""},subtitle:{enable:!0,text:"",css:{"text-align":"center",margin:"10px 13px 0px 7px"}},caption:{enable:!1,html:"Дата и Стоимость",css:{"text-align":"justify",margin:"10px 13px 0px 7px"}}}}function J(){if(I=[],a.state.date&&(a.current=x(a.state.date.value,a.state.amber_class,"Beads")),a.current)if("Dominican"==a.state.amber_class){a.select_options.domenic.frakcii.ball.forEach(function(a){I.push({frakcii:a})});var b=angular.copy(I).map(function(b){return a.select_options.domenic.form.forEach(function(a,c){b["form"+c]=N({frakcii:b.frakcii,sort:"Blue",form:a,type:"Beads"})}),b.mm=b.frakcii.split("/")[0],b.gr=b.frakcii.split("/")[1],b}),d=angular.copy(I).map(function(b){return a.select_options.domenic.form.forEach(function(a,c){b["form"+c]=N({frakcii:b.frakcii,sort:"Green",form:a,type:"Beads"})}),b.mm=b.frakcii.split("/")[0],b.gr=b.frakcii.split("/")[1],b}),e=angular.copy(I).map(function(b){return a.select_options.domenic.form.forEach(function(a,c){b["form"+c]=N({frakcii:b.frakcii,sort:"Yellow",form:a,type:"Beads"})}),b.mm=b.frakcii.split("/")[0],b.gr=b.frakcii.split("/")[1],b});b=K(b),d=K(d),e=K(e),a.tables.ball_blue=new c({count:100},{dataset:b}),a.tables.ball_green=new c({count:100},{dataset:d}),a.tables.ball_yellow=new c({count:100},{dataset:e}),a.tables.ball_blue.reload(),a.tables.ball_green.reload(),a.tables.ball_yellow.reload()}else{a.select_options.ball.frakcii.forEach(function(a){I.push({frakcii:a})});var f=angular.copy(I).map(function(b){return a.select_options.ball.form.slice(0,5).forEach(function(a,c){b["form"+c]=N({frakcii:b.frakcii,form:a,type:"Beads"})}),b.mm=b.frakcii.split("/")[0],b.gr=b.frakcii.split("/")[1],b}),g=angular.copy(I).map(function(b){return a.select_options.ball.form.slice(5,10).forEach(function(a,c){b["form"+c]=N({frakcii:b.frakcii,form:a,type:"Beads"})}),b.mm=b.frakcii.split("/")[0],b.gr=b.frakcii.split("/")[1],b});f=K(f),g=K(g),a.tables.ball=new c({count:100},{dataset:f}),a.tables.ball_opacue=new c({count:100},{dataset:f}),a.tables.ball_transparent=new c({count:100},{dataset:g}),a.tables.ball.reload(),a.tables.ball_opacue.reload(),a.tables.ball_transparent.reload()}else a.tables.ball=null,a.tables.ball_opacue=null,a.tables.ball_transparent=null}function K(b){var c;return c=0==a.currency.length?1:a.currency[a.currency.length-1][a.state.currency],b.map(function(a){return Object.assign({},a,{form0:Math.round(a.form0*c*100)/100,form1:Math.round(a.form1*c*100)/100,form2:Math.round(a.form2*c*100)/100,form3:Math.round(a.form3*c*100)/100,form4:Math.round(a.form4*c*100)/100,form5:Math.round(a.form5*c*100)/100,sort1:Math.round(a.sort1*c*100)/100,sort2:Math.round(a.sort2*c*100)/100,sort0:Math.round(a.sort0*c*100)/100,sort3:Math.round(a.sort3*c*100)/100,sort4:Math.round(a.sort4*c*100)/100})})}function L(){if(I=[],a.state.date&&(a.current=x(a.state.date.value,a.state.amber_class,"Rough")),a.current){if("Indonesian (Sumatra)"==a.state.amber_class)a.select_options.indonezian.frakcii.forEach(function(a){I.push({frakcii:a})});else if("Dominican"==a.state.amber_class){a.select_options.domenic.frakcii.raw.big.forEach(function(a){I.push({frakcii:a})});var b=angular.copy(I).map(function(b){return a.select_options.domenic.form.forEach(function(a,c){b["form"+c]=N({frakcii:b.frakcii,sort:"Blue",form:a,type:"Rough"})}),b.mm=b.frakcii.split("/")[0],b.gr=b.frakcii.split("/")[1],b});b=K(b),a.tables.raw_blue=new c({count:100},{dataset:b}),a.tables.raw_blue.reload(),I=[],a.select_options.domenic.frakcii.raw.small.forEach(function(a){I.push({frakcii:a})});var d=angular.copy(I).map(function(b){return a.select_options.domenic.form.forEach(function(a,c){b["form"+c]=N({frakcii:b.frakcii,sort:"Green",form:a,type:"Rough"})}),b.mm=b.frakcii.split("/")[0],b.gr=b.frakcii.split("/")[1],b});d=K(d),a.tables.raw_green=new c({count:100},{dataset:d}),a.tables.raw_green.reload(),I=[],a.select_options.domenic.frakcii.raw.small.forEach(function(a){I.push({frakcii:a})});var e=angular.copy(I).map(function(b){return a.select_options.domenic.form.forEach(function(a,c){b["form"+c]=N({frakcii:b.frakcii,sort:"Yellow",form:a,type:"Rough"})}),b.mm=b.frakcii.split("/")[0],b.gr=b.frakcii.split("/")[1],b});e=K(e),a.tables.raw_yellow=new c({count:100},{dataset:e}),a.tables.raw_yellow.reload()}else a.select_options.frakcii.forEach(function(a){var b=["100g.","200g.","300g.","500g.","1000g."].reverse(),c=!b.some(function(b){return b==a});I.push({frakcii:a,form:"Opaque/Beadable"}),I.push({frakcii:a,form:"Transparent/Beadable"}),c&&I.push({frakcii:a,form:"Opaque/Flat"}),c&&I.push({frakcii:a,form:"Transparent/Flat"})});"Indonesian (Sumatra)"==a.state.amber_class?I.map(function(b){return a.select_options.indonezian.sort.forEach(function(a,c){b["form"+c]=N({frakcii:b.frakcii,form:b.form,sort:a,type:"Rough"})}),b}):I.map(function(b){return a.select_options.sort.forEach(function(a,c){b["form"+c]=N({frakcii:b.frakcii,form:b.form,sort:a,type:"Rough"})}),b}),I=K(I);var f=I.filter(function(a){var b=["100g.","200g.","300g.","500g.","1000g."].reverse();return b.some(function(b){return a.frakcii==b})});a.tables.bigraw=new c({count:100},{dataset:f}),a.tables.bigraw.reload();var g=I.filter(function(a){var b=["100g.","200g.","300g.","500g.","1000g."].reverse();return b.every(function(b){return a.frakcii!=b})});a.tables.raw=new c({count:100},{dataset:g}),a.tables.raw.reload()}}function M(b){b[0]&&(b=b[0].data.map(function(a){return Object.assign({},a,{positive:+a.diff>0})}),a.deals=new c({count:100},{dataset:b}))}function N(b){var c,d;return b.country=a.state.country,"Rough"==b.type?c="Низкое"==b.sort||"Черный лак"==b.sort?function(a){return a.country==b.country&&a.frakcii==b.frakcii&&a.sort==b.sort}:function(a){return a.country==b.country&&a.form==b.form&&a.frakcii==b.frakcii&&a.sort==b.sort}:(b.type="Beads")&&(c="Blue"==b.sort||"Green"==b.sort||"Yellow"==b.sort?function(a){return a.country==b.country&&a.frakcii==b.frakcii&&a.form==b.form&&a.sort==b.sort}:function(a){return a.country==b.country&&a.frakcii==b.frakcii&&a.form==b.form}),d="Rough"==a.init_date?a.price_table.Rough.filter(c)[0]:"Beads"==a.init_date?a.price_table.Beads.filter(c)[0]:a.current.filter(c)[0],d?d.value:0}function O(){for(var a="0123456789abcdef",b="#",c=0;c<6;c++)b+=a[Math.floor(16*Math.random())];return b}function P(b){b||(b=a.multidata);var c=Number.POSITIVE_INFINITY,d=0;b.forEach(function(a){a.values.forEach(function(a){a.y>d&&(d=a.y),a.y<c&&(c=a.y)})}),c<0?a.options.chart.yDomain=[1.04*c,1.04*d]:a.options.chart.yDomain=[.96*c,1.04*d]}function Q(b){b||(b=a.multidata);var c=Number.POSITIVE_INFINITY,d=0;b.forEach(function(a){a.values.forEach(function(a){a.x>d&&(d=a.x),a.x<c&&(c=a.x)})}),a.options.chart.xDomain=[c,d]}function R(){return"Rough"==a.state.amber_type?"Indonesian (Sumatra)"==a.state.amber_class?function(b){return b.country==a.state.country&&b.frakcii==a.state.frakcii&&b.sort==a.state.sort}:function(b){return b.country==a.state.country&&b.form==a.state.form&&b.frakcii==a.state.frakcii&&b.sort==a.state.sort}:"Beads"==a.state.amber_type?"Blue"==a.state.sort||"Green"==a.state.sort||"Yellow"==a.state.sort?function(b){return b.country==a.state.country&&b.frakcii==a.state.frakcii&&b.form==a.state.form&&b.sort==a.state.sort}:function(b){return b.country==a.state.country&&b.form==a.state.form&&b.frakcii==a.state.frakcii}:"index"==a.state.amber_type||"Indexes"==a.state.amber_type?function(b){return b.country==a.state.country&&b.sub_type==a.state.sub_type}:function(){return!0}}function S(){return a.main&&a.main.map(function(b){var c=b.data.filter(a.criteria)[0]||{value:0};return{x:b.title.split("/")[1],y:c.value}})}function T(a,b){return Math.floor(Math.random()*(b-a+1))+a}var d={raw:"Rough",ball:"Beads",index:"Indexes",domenic:"Dominican",dominic:"Dominican",baltic:"Baltic",ukranian:"Ukrainian",mexican:"Mexican (Chiapas)",indonezian:"Indonesian (Sumatra)","Матовый/Компактный":"Opaque/Beadable","Прозрачный/Компактный":"Transparent/Beadable","Прозрачный/Плоский":"Transparent/Flat","Матовый/Плоский":"Opaque/Flat","МИКС":"MIX","ААА":"ААА","АА":"АА","А":"А","В":"В","С":"С","Голубой":"Blue","Зеленый":"Green","Желтый":"Yellow","Матовый/ААА":"Opaque/ААА","Матовый/АА":"Opaque/АА","Матовый/А":"Opaque/А","Матовый/В":"Opaque/В","Матовый/С":"Opaque/С","Прозрачный/ААА":"Transparent/ААА","Прозрачный/АА":"Transparent/АА","Прозрачный/А":"Transparent/А","Прозрачный/В":"Transparent/В","Прозрачный/С":"Transparent/С","Сырец":"Rough","Шар":"Ball"},p=[],q=0,r=0;b.get("http://amberprice.net/wp-json/posts?type[]=events&&filter[posts_per_page]=1000").then(function(b){var d=b.data.map(function(a){var b=a.terms,c={};c.link=decodeURIComponent(a.link),c.title=decodeURIComponent(a.title),a.excerpt&&(c.excerpt=decodeURIComponent(a.excerpt.slice(3,100)+"..."),c.excerpt=c.excerpt.replace(/<\/p>/g,'"')),a.featured_image&&(c.image=decodeURIComponent(a.featured_image.source));for(key in b)c[key]=decodeURIComponent(b[key][0].name);return c});d=d.map(function(a){if(a.start_time&&a.end_date){var b=a.start_time.slice(3,5)+"/"+a.start_time.slice(0,2)+"/"+a.start_time.slice(6),c=a.end_date.slice(3,5)+"/"+a.end_date.slice(0,2)+"/"+a.end_date.slice(6);return Object.assign({},a,{start_date:+new Date(Date.parse(b)),end_date:+new Date(Date.parse(c))})}});var e=(new Date).getMonth(),f=["January","Febrary","March","April","May","June","July","August","September","October","November","December"];for(a.new_monthes=[];12!=a.new_monthes.length;)a.new_monthes.push(f[e]),e++,12==e&&(e=0);window.init_slider(),a.current_event_month=(new Date).getMonth(),a.event_state=[],a.example_events=[],d.forEach(function(b){if(b&&b.start_date)var c=new Date(b.start_date).getMonth();else var c=-1;a.event_state[c]||(a.event_state[c]=[]),a.event_state[c].push(b)}),a.example_events=d.filter(function(a){return a&&a.master&&a.master.length>0}),a.event_container={},d.forEach(function(b){b&&Object.keys(b).forEach(function(c){a.event_container[c]||(a.event_container[c]=[]),a.event_container[c].push({id:b[c],title:b[c]})})}),d=d.filter(function(a){return a&&a.title&&a.title.length>0}),a.event_container.start_date=a.event_container.start_date.map(function(b){return{id:b.id,title:a.format_date(b.title)}}),a.event_container.end_date=a.event_container.end_date.map(function(b){return{id:b.id,title:a.format_date(b.title)}}),a.events=new c({count:100},{dataset:d}),a.showevent=!0}),a.change_current_event_month=function(b){b?a.current_event_month+=1:a.current_event_month-=1},e(),a.$watch("state",function(b,d){if(a.multidata||(a.options.noData="No data"),a.criteria=R(),b.amber_type!=d.amber_type||b.amber_class!=d.amber_class){if(a.main=a.bundle.filter(function(b){return b.amber_type==a.state.amber_type&&b.amber_class==a.state.amber_class}).sort(function(a,b){return a.time-b.time}),D(b.amber_type),"Indonesian (Sumatra)"==b.amber_class&&"Rough"==b.amber_type&&(a.state.frakcii="<50g."),"Dominican"==b.amber_class&&"Rough"==b.amber_type&&(a.state.frakcii=">100g."),b.amber_class!=d.amber_class&&"Dominican"==b.amber_class&&(a.multilines||(a.table_state="Rough (blue)"),a.state.sort="Blue",a.state.form="ААА","Rough"==b.amber_type?(a.state.frakcii=">100g.",a.state.sort="Blue",a.state.form="ААА"):"Beads"==b.amber_type&&(a.state.frakcii="20+/5+",a.state.sort="Blue",a.state.form="ААА")),"Dominican"==b.amber_class&&"Beads"==b.amber_type&&(a.state.frakcii="20+/5+"),b.amber_type!=d.amber_type){var e=B(angular.copy(a.store_indexes));if(a.currency&&(e=e.map(function(b){var c=a.currency[a.currency.length-1][a.state.currency];return b.data=b.data.map(function(a){return Object.assign({},a,{value:Math.round(a.value*c*100)/100,diff:z(Math.round(100*a.diff)/100),diff_absolute:z(Math.round(a.diff_absolute*c*100)/100)})}),b}),a.amberindex=e[e.length-1].data.filter(function(a){return"Amber Index (AI)"==a.sub_type})[0],a.multidata.length>0&&b.currency!=d.currency)){var f=angular.copy(a.multidata_base);f=f.map(function(b){var c=b.values;return c=c.map(function(b){return b.y=b.y*a.currency[a.currency.length-1][a.state.currency],b}),b.values=c,b}),a.multidata=f,P(),a.api.refresh()}a.indexes=new c({count:100},{dataset:e[e.length-1].data}),a.indexes.reload()}if(b.amber_class!=d.amber_class&&a.multilines){var e=B(angular.copy(a.store_indexes));if(e=e.map(function(b){var c=a.currency[a.currency.length-1][a.state.currency];return b.data=b.data.map(function(a){return Object.assign({},a,{value:Math.round(a.value*c*100)/100,diff:z(Math.round(100*a.diff)/100),diff_absolute:z(Math.round(a.diff_absolute*c*100)/100)})}),b}),a.select_indexes=e[e.length-1].data,a.select_indexes.length>0){var g={},h=[];a.select_indexes.forEach(function(a){g[a.index_type]=1}),g=Object.keys(g),g.forEach(function(b){h[b]=[],a.select_indexes.forEach(function(a){a.index_type==b&&h[b].push(a.sub_type)})}),a.index_types=g,a.sub_types=h,a.state.sub_type=a.sub_types[a.state.index_type][1]}}}if(b.index_type!=d.index_type){var e=B(angular.copy(a.store_indexes));if(e=e.map(function(b){var c=a.currency[a.currency.length-1][a.state.currency];return b.data=b.data.map(function(a){return Object.assign({},a,{value:Math.round(a.value*c*100)/100,diff:z(Math.round(100*a.diff)/100),diff_absolute:z(Math.round(a.diff_absolute*c*100)/100)})}),b}),a.select_indexes=e[e.length-1].data,a.select_indexes.length>0){var g={},h=[];a.select_indexes.forEach(function(a){g[a.index_type]=1}),g=Object.keys(g),g.forEach(function(b){h[b]=[],a.select_indexes.forEach(function(a){a.index_type==b&&h[b].push(a.sub_type)})}),a.index_types=g,a.sub_types=h,a.state.sub_type=a.sub_types[a.state.index_type][1]}a.state.sub_type=a.sub_types[b.index_type][0]}if(b.amber_class!=d.amber_class&&("Indonesian (Sumatra)"==b.amber_class?a.table_state="Rough":"Mexican (Chiapas)"==b.amber_class?a.table_state="Beads":"Dominican"==b.amber_class?(a.multilines||(a.table_state="Rough (blue)"),a.state.sort="Blue",a.state.form="ААА","Rough"==b.amber_type?(a.state.frakcii=">100g.",a.state.sort="Blue",a.state.form="ААА"):"Beads"==b.amber_type&&(a.state.frakcii="20+/5+",a.state.sort="Blue",a.state.form="ААА")):a.table_state="Rough (medium fractions)","Rough"==b.amber_type?L():"Beads"==b.amber_type&&J()),b.country!=d.country||b.currency!=d.currency){"Rough"==b.amber_type?L():"Beads"==b.amber_type&&J(),store.set("currency",b.currency);var e=B(angular.copy(a.store_indexes));a.currency&&(e=e.map(function(b){var c=a.currency[a.currency.length-1][a.state.currency];return b.data=b.data.map(function(a){return Object.assign({},a,{value:Math.round(a.value*c*100)/100,diff:z(Math.round(100*a.diff)/100),diff_absolute:z(Math.round(a.diff_absolute*c*100)/100)})}),b}),a.amberindex=e[e.length-1].data.filter(function(a){
return"Amber Index (AI)"==a.sub_type})[0],a.multidata.length>0&&b.currency!=d.currency),a.indexes=new c({count:100},{dataset:e[e.length-1].data}),a.indexes.reload()}if("Dominican"!=a.state.amber_class&&(a.indostate.form=b.form.split("/")[1],["100g.","200g.","300g.","500g.","1000g."].some(function(a){return b.frakcii==a})?a.indostate.frakcii=">"+b.frakcii:a.indostate.frakcii=b.frakcii),a.main&&0==a.multidata.length){var i=a.display();i&&i.values&&i.values[0]&&0!=i.values[0].y&&(a.data=[a.display()],a.api&&a.api.refresh())}if(b.date&&d.date&&b.date.value!=d.date.value){var e=B(angular.copy(a.store_indexes)),j=e.filter(function(b){return a.state.date.value==b.time.toString()});if(a.currency.length>0)var k=a.currency[a.currency.length-1][a.state.currency];else var k=1;j.length>0?(j=j[0].data.map(function(a){return Object.assign({},a,{value:a.value*k,diff:z(a.diff),diff_absolute:z(a.diff_absolute*k)})}),a.amberindex=j.filter(function(a){return"Amber Index (AI)"==a.sub_type})[0]):j=null,a.indexes=new c({count:100},{dataset:j}),a.indexes.reload()}if(a.data_bundle)try{a.price_table=a.data_bundle[a.state.date.value][a.state.amber_class],L(),J(),a.init_date=!1}catch(a){}},!0),a.$watch("showapp",function(b){var c=window.navigator.userAgent;(c.match(/iPad/i)||c.match(/iPhone/i))&&(a.state.amber_class="Indonesian (Sumatra)",setTimeout(function(b){a.state.amber_class="Baltic"},50))}),a.$watch("table_state",function(b){a.state&&!a.multilines&&(b.indexOf("rough")!=-1||b.indexOf("Rough")!=-1?a.state.amber_type="Rough":b.indexOf("Beads")!=-1||b.indexOf("beads")!=-1?a.state.amber_type="Beads":a.state.amber_type="Indexes",b.indexOf("blue")!=-1||b.indexOf("Blue")!=-1?a.state.sort="Blue":b.indexOf("green")!=-1||b.indexOf("Green")!=-1?a.state.sort="Green":b.indexOf("yellow")==-1&&b.indexOf("Yellow")==-1||(a.state.sort="Yellow"))},!0),a.$watch("graph",function(a){F(a.graph_time,a.graph_type)},!0),a.$watch("indostate",function(b){"Indonesian (Sumatra)"==a.state.amber_class&&(a.state.form="Opaque/"+b.form),">"==b.frakcii[0]?a.state.frakcii=b.frakcii.slice(1):a.state.frakcii=b.frakcii},!0),a.$watch("data",function(b){var e,f,c=b[0].values,d=c.length,g={};d>1?(e=c[c.length-1].y,f=c[c.length-2].y,g.value=e-f,g.persent=((e-f)/f*100).toFixed(2)+"%",g.positive=g.value>0,g.actual=e):(g.value=0,g.persent=0,g.positive=!1,g.actual=0),a.index=g},!0),a.makemoresymbol=function(a){return A(">",a)};var E=550;a.clear_them_all=function(){a.multidata=[],a.multidata_base=[]},a.add_to_bundle=function(){var b=a.display();b.color=O(),"Rough"==a.state.amber_type?b.key=a.state.amber_type+" | "+a.state.amber_class+" | "+a.state.form+" | "+a.state.frakcii+" | "+a.state.sort:"Beads"==a.state.amber_type?b.key=a.state.amber_type+" | "+a.state.amber_class+" | "+a.state.form+" | "+a.state.frakcii:"index"!=a.state.amber_type&&"Indexes"!=a.state.amber_type||(b.key=a.state.amber_type+" | "+a.state.amber_class+" | "+a.state.index_type+"/"+a.state.sub_type);var c=a.multidata.filter(function(a){return b.key==a.key});if(0!=c.length)return setTimeout(function(){jQuery("svg.nvd3-svg").height(E)},200),Q(a.multidata),void P(a.multidata);var d=S(),e=d.map(function(a){return{x:+new Date(a.x.split(".").join("/")),y:+a.y}}).sort(function(a,b){return a.x-b.x}),f=Object.assign({},b,{values:e});a.multidata_base.push(f),F(a.graph.graph_time,a.graph.graph_type)};var I=[];a.cutedges=function(a){if(a)return a.split("/")[1][0]+a.split("/")[0][0]},a.getFirstWord=function(a){if(a)return a.split("/")[0]},a.change_state=function(b){a.state=Object.assign(a.state,b)}}]),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(a,b){"use strict";if(void 0===a||null===a)throw new TypeError("Cannot convert first argument to object");for(var c=Object(a),d=1;d<arguments.length;d++){var e=arguments[d];if(void 0!==e&&null!==e)for(var f=Object.keys(Object(e)),g=0,h=f.length;g<h;g++){var i=f[g],j=Object.getOwnPropertyDescriptor(e,i);void 0!==j&&j.enumerable&&(c[i]=e[i])}}return c}}),window.init_slider=function(){function e(){jQuery("#slider ul").animate({left:+b},200,function(){jQuery("#slider ul li:last-child").prependTo("#slider ul"),jQuery("#slider ul").css("left","")})}function f(){jQuery("#slider ul").animate({left:-b},200,function(){jQuery("#slider ul li:first-child").appendTo("#slider ul"),jQuery("#slider ul").css("left","")})}jQuery("#checkbox").change(function(){setInterval(function(){f()},3e3)});var a=jQuery("#slider ul li").length,b=jQuery("#slider ul li").width(),c=jQuery("#slider ul li").height(),d=a*b;jQuery("#slider").css({width:b,height:c}),jQuery("#slider ul").css({width:d,marginLeft:-b}),jQuery("#slider ul li:last-child").prependTo("#slider ul"),jQuery("a.control_prev").click(function(){e()}),jQuery("a.control_next").click(function(){f()})},jQuery(document).ready(function(){jQuery(".b-news .fusion-post-content-container p:last-of-type").each(function(){jQuery(this).text(jQuery(this).text()+"...")}),jQuery(".related-posts .title-heading-left").text("Other publications")});</script>